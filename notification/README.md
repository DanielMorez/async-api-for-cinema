# üìß –°–µ—Ä–≤–∏—Å –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

## üõ† –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

[![My Skills](https://skillicons.dev/icons?i=python,fastapi,rabbitmq,docker,nginx&perline=5)](https://skillicons.dev)


## üîë –û–∫—Ä—É–∂–µ–Ω–∏–µ

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env` `SMTP__EMAIL` –∏ `SMTP__PASSWORD` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞


## üìö –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å

–ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–∞—Å–∫—É –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏ –ø–∏—Å–µ–º —É–∫–∞–∑–∞–≤ —Ñ–∏–ª—å—Ç—Ä –¥–ª—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –î–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ —Å–¥–µ–ª–∞–ª–∏ –¥–≤–∞ —Ñ–∏–ª—å—Ç—Ä–∞.

```python
{
    "user_filters": {
        "has_enail": True
    }  # –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å email
}
```

```python
{
    "user_ids": [
        "b08486ad-5e93-485b-ba7a-7efc1319ebdf"
    ]  # –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —ç—Ç–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
}
```

–¢–∞–∫ –∂–µ –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–∏ –¥–æ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, –∑–∞–ø–æ–ª–Ω–∏–≤ –ø–æ–ª–µ
`scheduled_datetime`


## üì¨ –®–µ–¥—É–ª–µ—Ä

–° –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ —Ç–∞—Å–∫ –ø–æ —É—Å–ª–æ–≤–∏—é

```postgresql
SELECT id, title, status, context, created_at, updated_at, type, crontab, scheduled_datetime, template_id
FROM notification.tasks
WHERE status = 'pending' 
AND (scheduled_datetime < current_timestamp OR scheduled_datetime IS NULL)
ORDER BY scheduled_datetime
LIMIT {extract_chunk};
```

–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –≤ `context` —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫ `user_ids` (–µ—Å–ª–∏ –æ–Ω –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—É—Å—Ç—ã–º, —Ç–æ –æ—Ç–º–µ–Ω—è–µ—Ç —Ç–∞—Å–∫—É - `canceled`)
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å `done`.

```postgresql
UPDATE notification.tasks SET status = '{status}' WHERE id = '{task_id}';
```

## üöÄ API

–ò–º–µ–µ—Ç –¥–≤–∞ –º–µ—Ç–æ–¥–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –º–æ–∂–Ω–æ –∑–¥–µ—Å—å `http://localhost/api/notifications/openapi#`

1. –ú–µ—Ç–æ–¥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ª—é–±–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ç–∏–º–ø–ª–µ–π—Ç–æ–º –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
2. –ú–µ—Ç–æ–¥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–∏—å—Å–º–∞ (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–≤–æ–≥–æ –º–µ—Ç–æ–¥–∞, –Ω–æ —Å –∑–∞—à–∏—Ç—ã–º —Ç–∏–º–ø–ª–µ–π—Ç–æ–º)

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

```commandline
curl -X 'POST' \
  'http://localhost:8002/notifications/send' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "type": "send_immediately",
  "template_id": 1,
  "user_ids": [
    "b08486ad-5e93-485b-ba7a-7efc1319ebdf"
  ],
  "context": {"user_filters": {"has_email": true}}
}'
```

–ú–µ—Ç–æ–¥—ã –ø–µ—Ä–µ–∫–ª–∞–¥—ã–≤–∞—é—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—å RabbitMQ


## üé¢ –í–æ—Ä–∫–µ—Ä

–ü—Ä–æ—Å–ª—É—à–∏–≤–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å RabbitMQ, –∏ –µ—Å–ª–∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, —Ç–æ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ `user_ids` –∏ –∑–∞–±–∏—Ä–∞–µ—Ç —à–∞–±–ª–æ–Ω –ø–∏—å—Å–º–∞ –ø–æ `template_id`
–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –≤ –∞–∫–∫–∞—É–Ω—Ç–µ email-—É